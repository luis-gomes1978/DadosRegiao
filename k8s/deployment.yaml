apiVersion: apps/v1
kind: Deployment
metadata:
  name: dadosregiao-deployment
spec:
  replicas: 1 # Apenas 1 cópia para economizar
  selector:
    matchLabels:
      app: dadosregiao
  template:
    metadata:
      labels:
        app: dadosregiao
    spec:
      containers:
      - name: dadosregiao-container
        image: __IMAGE_PLACEHOLDER__ # Placeholder será substituído pelo script de deploy
        ports:
        - containerPort: 8501 # A porta que o Streamlit usa dentro do contêiner
        env:
        - name: TZ
          value: "America/Sao_Paulo" # Define o timezone para GMT-3 (Horário de Brasília)
        imagePullPolicy: Always # Garante que a imagem mais recente seja sempre baixada
        # Verificações de saúde para que o Kubernetes gerencie o pod de forma inteligente
        readinessProbe:
          httpGet:
            path: /healthz # Endpoint de saúde padrão do Streamlit
            port: 8501
          initialDelaySeconds: 15
          periodSeconds: 10
        livenessProbe:
          httpGet:
            path: /healthz
            port: 8501
          initialDelaySeconds: 30
          periodSeconds: 20
        volumeMounts:
        - name: config-volume
          mountPath: /app/config.yaml # Onde o arquivo será montado dentro do contêiner
          subPath: config.yaml      # O nome do arquivo dentro do Secret a ser montado
      volumes:
      - name: config-volume
        secret:
          secretName: dadosregiao-config # O nome do Secret que criamos no script
